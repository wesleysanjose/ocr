<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="伤残鉴定案件管理系统" />
    <title>伤残鉴定案件管理系统</title>

    <!-- External CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/css/main.css" />
    <link rel="stylesheet" href="/static/css/document-viewer.css" />
  </head>
  <body class="bg-gray-100 min-h-screen">
    <div class="flex h-screen">
      <!-- 左侧案件列表 -->
      <div class="w-1/3 bg-white p-4 border-r shadow-sm overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold">案件列表</h2>
          <button
            id="new-case-btn"
            class="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"
                clip-rule="evenodd"
              />
            </svg>
            <span>新建案件</span>
          </button>
        </div>

        <!-- 搜索框 -->
        <div class="relative mb-4">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 absolute left-3 top-3 text-gray-400"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
              clip-rule="evenodd"
            />
          </svg>
          <input
            type="text"
            id="search-input"
            placeholder="搜索案件编号/姓名"
            class="w-full pl-10 pr-4 py-2 border rounded-lg"
          />
        </div>

        <!-- 状态过滤导航栏 -->
        <div id="status-tabs" class="flex gap-2 mb-4 border-b overflow-x-auto">
          <button
            data-status="全部"
            class="px-4 py-2 text-blue-600 border-b-2 border-blue-600 active-tab whitespace-nowrap"
          >
            全部
          </button>
          <button
            data-status="待处理"
            class="px-4 py-2 text-gray-500 hover:text-blue-600 whitespace-nowrap"
          >
            待处理
          </button>
          <button
            data-status="进行中"
            class="px-4 py-2 text-gray-500 hover:text-blue-600 whitespace-nowrap"
          >
            进行中
          </button>
          <button
            data-status="待审核"
            class="px-4 py-2 text-gray-500 hover:text-blue-600 whitespace-nowrap"
          >
            待审核
          </button>
          <button
            data-status="已完成"
            class="px-4 py-2 text-gray-500 hover:text-blue-600 whitespace-nowrap"
          >
            已完成
          </button>
        </div>

        <!-- 案件列表 -->
        <div id="case-list" class="space-y-3">
          <!-- 列表内容会通过JavaScript动态加载 -->
          <div class="loading">加载中...</div>
        </div>

        <!-- 分页 -->
        <div id="pagination" class="flex justify-center gap-2 mt-4">
          <!-- 分页内容会通过JavaScript动态加载 -->
        </div>
      </div>
      <!-- 右侧案件详情 -->
      <div id="case-detail" class="flex-1 p-6 overflow-y-auto hidden">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold">案件详情</h2>
          <div class="space-x-3">
            <button
              id="export-report-btn"
              class="px-4 py-2 border rounded-lg hover:bg-gray-50"
            >
              导出报告
            </button>
            <button
              id="save-changes-btn"
              class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
            >
              保存修改
            </button>
          </div>
        </div>

        <form id="case-info-form" class="grid grid-cols-2 gap-6">
          <!-- 基本信息卡片 -->
          <div class="bg-white p-4 rounded-lg shadow">
            <h3 class="text-lg font-semibold mb-4">基本信息</h3>

            <div class="space-y-4">
              <div class="grid grid-cols-1 gap-4">
                <div>
                  <label
                    for="case-name"
                    class="block text-sm font-medium text-gray-700 mb-1"
                    >姓名</label
                  >
                  <input
                    type="text"
                    id="case-name"
                    name="name"
                    class="w-full p-2 border rounded"
                    required
                  />
                </div>

                <div>
                  <label
                    for="case-phone"
                    class="block text-sm font-medium text-gray-700 mb-1"
                    >联系电话</label
                  >
                  <input
                    type="text"
                    id="case-phone"
                    name="phone"
                    class="w-full p-2 border rounded"
                    required
                  />
                </div>

                <div>
                  <label
                    for="case-type"
                    class="block text-sm font-medium text-gray-700 mb-1"
                    >案件类型</label
                  >
                  <select
                    id="case-type"
                    name="type"
                    class="w-full p-2 border rounded"
                  >
                    <option value="交通事故">交通事故</option>
                    <option value="工伤认定">工伤认定</option>
                    <option value="医疗事故">医疗事故</option>
                    <option value="其他伤害">其他伤害</option>
                  </select>
                </div>

                <div>
                  <label
                    for="case-status"
                    class="block text-sm font-medium text-gray-700 mb-1"
                    >案件状态</label
                  >
                  <select
                    id="case-status"
                    name="status"
                    class="w-full p-2 border rounded"
                  >
                    <option value="待处理">待处理</option>
                    <option value="进行中">进行中</option>
                    <option value="待审核">待审核</option>
                    <option value="已完成">已完成</option>
                  </select>
                </div>

                <div>
                  <label
                    for="case-number"
                    class="block text-sm font-medium text-gray-700 mb-1"
                    >案件编号</label
                  >
                  <input
                    type="text"
                    id="case-number"
                    class="w-full p-2 border rounded bg-gray-50"
                    readonly
                  />
                </div>

                <div>
                  <label
                    for="case-create-time"
                    class="block text-sm font-medium text-gray-700 mb-1"
                    >立案时间</label
                  >
                  <input
                    type="text"
                    id="case-create-time"
                    class="w-full p-2 border rounded bg-gray-50"
                    readonly
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- 文档处理卡片 -->
          <div class="bg-white p-4 rounded-lg shadow">
            <h3 class="text-lg font-semibold mb-4">文档处理</h3>

            <!-- 文档上传表单 -->
            <form id="document-upload-form" class="mb-4">
              <div class="border-2 border-dashed rounded-lg p-6 text-center">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-8 w-8 mx-auto text-gray-400 mb-2"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    fill-rule="evenodd"
                    d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z"
                    clip-rule="evenodd"
                  />
                </svg>
                <input
                  type="file"
                  id="document-file-input"
                  accept=".jpg,.jpeg,.png,.pdf"
                  class="hidden"
                />
                <label
                  for="document-file-input"
                  class="cursor-pointer text-blue-500 hover:text-blue-600"
                >
                  <p>点击或拖拽上传文件</p>
                  <p class="text-sm text-gray-500">支持 PDF 或图片格式</p>
                </label>

                <div class="mt-3">
                  <label
                    for="document-type-select"
                    class="block text-sm font-medium text-gray-700 mb-1"
                    >文档类型</label
                  >
                  <select
                    id="document-type-select"
                    class="w-full p-2 border rounded"
                  >
                    <option value="医院病历">医院病历</option>
                    <option value="事故认定书">事故认定书</option>
                    <option value="诊断证明">诊断证明</option>
                    <option value="伤情照片">伤情照片</option>
                    <option value="其他资料">其他资料</option>
                  </select>
                </div>
              </div>

              <button
                id="upload-document-btn"
                type="submit"
                class="mt-2 w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
              >
                上传文档
              </button>
            </form>

            <!-- 已上传文档列表 -->
            <div>
              <h4 class="font-medium mb-2">已上传文档</h4>
              <div
                id="documents-list"
                class="max-h-80 overflow-y-auto custom-scrollbar"
              >
                <!-- 文档列表会通过JavaScript动态加载 -->
                <div class="empty-state text-center text-gray-500 py-4">
                  尚未上传文档
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- 初始状态提示 -->
      <div
        id="empty-state"
        class="flex-1 flex items-center justify-center text-gray-400"
      >
        <p>请选择一个案件查看详情</p>
      </div>
    </div>
    <!-- 文档查看器 -->
    <div
      id="document-viewer"
      class="fixed inset-0 bg-gray-800 bg-opacity-75 z-50 hidden"
    >
      <div class="container mx-auto h-full py-6 px-4 flex flex-col">
        <!-- Header with document title and close button -->
        <div class="flex justify-between items-center mb-2">
          <h2 class="text-xl font-bold text-white" id="document-title">
            文档查看
          </h2>
          <button id="close-viewer" class="text-white hover:text-gray-300">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>

        <!-- Tab Navigation -->
        <div class="bg-white rounded-t-lg border-b border-gray-200">
          <div class="flex overflow-x-auto">
            <div class="document-tab active" data-tab="preview-tab">
              文档预览
            </div>
            <div class="document-tab" data-tab="ocr-tab">OCR文本</div>
            <div class="document-tab" data-tab="organize-tab">信息整理</div>
            <div class="document-tab" data-tab="report-tab">鉴定报告</div>
            <div class="document-tab" data-tab="analysis-tab">AI分析</div>
          </div>
        </div>

        <!-- Tab Content Container -->
        <div
          class="bg-white rounded-b-lg flex-grow overflow-hidden flex flex-col"
        >
          <!-- Preview Tab Content -->
          <div
            id="preview-tab"
            class="document-tab-content active h-full flex flex-col p-4"
          >
            <div
              id="preview-section"
              class="flex-grow bg-white rounded-lg shadow p-4 overflow-hidden flex flex-col"
            >
              <div
                class="relative border rounded-lg p-2 bg-white flex-grow overflow-hidden"
              >
                <div class="overflow-auto custom-scrollbar h-full">
                  <div class="relative">
                    <img
                      id="preview-image"
                      class="max-w-full transition-transform duration-200"
                      src=""
                      alt="文档预览"
                    />
                  </div>
                </div>
              </div>

              <!-- Zoom and Page Navigation Controls -->
              <div class="mt-4 flex justify-between">
                <!-- Zoom controls -->
                <div class="flex items-center gap-4">
                  <button
                    id="zoom-out"
                    class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed"
                  >
                    <span class="text-lg">−</span>
                  </button>
                  <span id="zoom-level" class="px-3 py-1 bg-gray-100 rounded"
                    >100%</span
                  >
                  <button
                    id="zoom-in"
                    class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed"
                  >
                    <span class="text-lg">+</span>
                  </button>
                </div>

                <!-- Page navigation -->
                <div class="flex items-center gap-4">
                  <button
                    id="prev-page"
                    class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed"
                  >
                    <span class="text-lg">&lt;</span>
                  </button>
                  <span id="page-info" class="px-3 py-1 bg-gray-100 rounded"
                    >第 1 页，共 1 页</span
                  >
                  <button
                    id="next-page"
                    class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed"
                  >
                    <span class="text-lg">&gt;</span>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- OCR Text Tab Content -->
          <div id="ocr-tab" class="document-tab-content h-full p-4">
            <div class="h-full grid grid-cols-1 gap-4">
              <div class="bg-white rounded-lg shadow p-4 flex flex-col h-full">
                <h3 class="text-lg font-semibold mb-4">OCR 识别结果</h3>

                <!-- OCR results with pagination selector -->
                <div
                  class="flex mb-2 border-b pb-2"
                  id="page-selector-container"
                >
                  <button
                    class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-sm mr-1 page-selector active"
                    data-page="1"
                  >
                    第1页
                  </button>
                  <button
                    class="px-2 py-1 text-gray-600 hover:bg-gray-100 rounded text-sm mr-1 page-selector"
                    data-page="2"
                  >
                    第2页
                  </button>
                  <button
                    class="px-2 py-1 text-gray-600 hover:bg-gray-100 rounded text-sm mr-1 page-selector"
                    data-page="3"
                  >
                    第3页
                  </button>
                </div>

                <!-- OCR Results Display -->
                <div
                  id="ocr-results"
                  class="flex-grow p-3 border border-gray-300 rounded mb-4 overflow-auto custom-scrollbar"
                ></div>

                <!-- Selected Text Display -->
                <div class="border rounded-lg p-3 bg-gray-50">
                  <h4 class="font-medium text-sm mb-2">选中的文本</h4>
                  <div
                    id="selected-text-display"
                    class="text-sm max-h-24 overflow-y-auto custom-scrollbar"
                  >
                    <div class="p-2 text-gray-500 text-center">
                      未选择任何文本
                    </div>
                  </div>
                </div>

                <!-- Selection Controls -->
                <div class="mt-4 flex justify-end">
                  <button
                    id="clear-selection-btn"
                    class="px-3 py-1 mr-2 border border-gray-300 text-gray-600 rounded hover:bg-gray-50"
                    disabled
                  >
                    清除选择
                  </button>
                  <button
                    id="process-btn"
                    class="px-4 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed"
                    disabled
                  >
                    添加到信息字段
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Organize Fields Tab Content -->
          <div id="organize-tab" class="document-tab-content h-full p-4">
            <div class="h-full grid grid-cols-2 gap-4">
              <!-- Left panel - extracted fields -->
              <div class="bg-white rounded-lg shadow p-4 flex flex-col">
                <h3 class="text-lg font-semibold mb-4">已提取字段</h3>

                <!-- Category tabs -->
                <div class="flex border-b mb-3">
                  <button
                    class="py-2 px-3 border-b-2 border-blue-500 text-blue-600 field-category-tab active"
                    data-category="all"
                  >
                    全部
                  </button>
                  <button
                    class="py-2 px-3 text-gray-600 field-category-tab"
                    data-category="personal"
                  >
                    个人信息
                  </button>
                  <button
                    class="py-2 px-3 text-gray-600 field-category-tab"
                    data-category="medical"
                  >
                    医疗信息
                  </button>
                  <button
                    class="py-2 px-3 text-gray-600 field-category-tab"
                    data-category="incident"
                  >
                    事故信息
                  </button>
                  <button
                    class="py-2 px-3 text-gray-600 field-category-tab"
                    data-category="legal"
                  >
                    法律信息
                  </button>
                </div>

                <!-- Fields display -->
                <div
                  id="kv-display"
                  class="flex-grow overflow-auto custom-scrollbar border rounded p-2"
                ></div>

                <!-- Field controls -->
                <div class="mt-3 flex justify-between">
                  <button
                    id="add-custom-field"
                    class="px-3 py-1 border border-gray-300 text-gray-600 rounded hover:bg-gray-50"
                  >
                    添加自定义字段
                  </button>
                  <button
                    id="copy-all-fields"
                    class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600"
                  >
                    复制所有字段
                  </button>
                </div>
              </div>

              <!-- Right panel - field organization -->
              <div class="bg-white rounded-lg shadow p-4 flex flex-col">
                <h3 class="text-lg font-semibold mb-4">字段分组</h3>

                <!-- Category management -->
                <div class="border rounded-lg p-3 mb-3 flex-grow overflow-auto">
                  <div class="flex justify-between items-center mb-2">
                    <h4 class="font-medium">字段分类</h4>
                    <button class="text-sm text-blue-600 hover:text-blue-800">
                      管理分类
                    </button>
                  </div>

                  <div class="space-y-2">
                    <!-- Personal Info Section -->
                    <div class="border rounded p-2">
                      <div
                        class="flex justify-between items-center cursor-pointer category-header"
                      >
                        <div class="flex items-center">
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-4 w-4 mr-1 text-blue-600"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                          >
                            <path
                              fill-rule="evenodd"
                              d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                              clip-rule="evenodd"
                            />
                          </svg>
                          <span class="font-medium">个人信息</span>
                        </div>
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-5 w-5 text-gray-400"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                      <div class="mt-2 category-content">
                        <div class="p-2 bg-gray-50 rounded text-sm">
                          拖拽字段到此处添加到个人信息分类
                        </div>
                      </div>
                    </div>

                    <!-- Medical Info Section -->
                    <div class="border rounded p-2">
                      <div
                        class="flex justify-between items-center cursor-pointer category-header"
                      >
                        <div class="flex items-center">
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-4 w-4 mr-1 text-green-600"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                          >
                            <path
                              fill-rule="evenodd"
                              d="M3 6a3 3 0 013-3h10a1 1 0 01.8 1.6L14.25 8l2.55 3.4A1 1 0 0116 13H6a1 1 0 00-1 1v3a1 1 0 11-2 0V6z"
                              clip-rule="evenodd"
                            />
                          </svg>
                          <span class="font-medium">医疗信息</span>
                        </div>
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-5 w-5 text-gray-400"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                      <div class="mt-2 category-content hidden">
                        <div class="p-2 bg-gray-50 rounded text-sm">
                          拖拽字段到此处添加到医疗信息分类
                        </div>
                      </div>
                    </div>

                    <!-- Incident Info Section -->
                    <div class="border rounded p-2">
                      <div
                        class="flex justify-between items-center cursor-pointer category-header"
                      >
                        <div class="flex items-center">
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-4 w-4 mr-1 text-red-600"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                          >
                            <path
                              fill-rule="evenodd"
                              d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05c-.867 0-1.398.54-1.786 1.195-.388.656-.655 1.56-.655 2.676 0 .15.015.3.04.448.025.147.029.25.038.352.03.338.097.655.18.972a3 3 0 00.1.38c.2.575.6 1.1 1.2 1.5 1.2.8 2.1.9 3.4.3.8-.4 1.3-.9 1.8-1.7.3-.6.6-1.2.8-1.8.1-.3.1-.5.2-.8v-1.2c-.2-.6-.3-1.2-.5-1.7-.2-.5-.5-1-.8-1.4-.3-.4-.7-.8-1.2-1.1z"
                              clip-rule="evenodd"
                            />
                          </svg>
                          <span class="font-medium">事故信息</span>
                        </div>
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-5 w-5 text-gray-400"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                      <div class="mt-2 category-content hidden">
                        <div class="p-2 bg-gray-50 rounded text-sm">
                          拖拽字段到此处添加到事故信息分类
                        </div>
                      </div>
                    </div>

                    <!-- Legal Info Section -->
                    <div class="border rounded p-2">
                      <div
                        class="flex justify-between items-center cursor-pointer category-header"
                      >
                        <div class="flex items-center">
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-4 w-4 mr-1 text-indigo-600"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                          >
                            <path
                              fill-rule="evenodd"
                              d="M10 2a1 1 0 011 1v1.323l3.954 1.582 1.599-.8a1 1 0 01.894 1.79l-1.233.616 1.738 5.42a1 1 0 01-.285 1.05A3.989 3.989 0 0115 15a3.989 3.989 0 01-2.667-1.019 1 1 0 01-.285-1.05l1.715-5.349L11 6.477V16h2a1 1 0 110 2H7a1 1 0 110-2h2V6.477L6.237 7.582l1.715 5.349a1 1 0 01-.285 1.05A3.989 3.989 0 015 15a3.989 3.989 0 01-2.667-1.019 1 1 0 01-.285-1.05l1.738-5.42-1.233-.617a1 1 0 01.894-1.788l1.599.799L9 4.323V3a1 1 0 011-1z"
                              clip-rule="evenodd"
                            />
                          </svg>
                          <span class="font-medium">法律信息</span>
                        </div>
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-5 w-5 text-gray-400"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                      <div class="mt-2 category-content hidden">
                        <div class="p-2 bg-gray-50 rounded text-sm">
                          拖拽字段到此处添加到法律信息分类
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Apply to templates -->
                <div class="mt-auto">
                  <button
                    id="apply-to-report"
                    class="w-full py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                  >
                    应用到鉴定报告
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Report Tab Content -->
          <div id="report-tab" class="document-tab-content h-full p-4">
            <div class="h-full grid grid-cols-1 gap-4">
              <div class="bg-white rounded-lg shadow p-4 flex flex-col">
                <div class="flex justify-between mb-4">
                  <h3 class="text-lg font-semibold">鉴定报告编辑</h3>

                  <div class="flex space-x-2">
                    <select
                      id="report-template"
                      class="border rounded px-2 py-1 text-sm"
                    >
                      <option value="traffic">交通事故鉴定报告</option>
                      <option value="work">工伤认定报告</option>
                      <option value="medical">医疗事故鉴定报告</option>
                      <option value="injury">伤残等级评定报告</option>
                    </select>
                    <button
                      id="load-template"
                      class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm"
                    >
                      加载模板
                    </button>
                  </div>
                </div>

                <!-- Report Editor -->
                <div
                  class="flex-grow border rounded overflow-hidden flex flex-col"
                >
                  <div
                    class="bg-gray-50 border-b p-2 flex items-center space-x-2"
                  >
                    <button
                      class="px-2 py-1 border rounded bg-white hover:bg-gray-50 text-sm font-medium"
                    >
                      标题
                    </button>
                    <button
                      class="px-2 py-1 border rounded bg-white hover:bg-gray-50 text-sm"
                    >
                      内容
                    </button>
                    <button
                      class="px-2 py-1 border rounded bg-white hover:bg-gray-50 text-sm"
                    >
                      表格
                    </button>
                    <button
                      class="px-2 py-1 border rounded bg-white hover:bg-gray-50 text-sm"
                    >
                      插入字段
                    </button>
                    <div class="ml-auto flex items-center space-x-2">
                      <button
                        class="px-2 py-1 border rounded bg-white hover:bg-gray-50 text-sm"
                      >
                        预览
                      </button>
                      <button
                        class="px-2 py-1 border rounded bg-white hover:bg-gray-50 text-sm"
                      >
                        保存草稿
                      </button>
                    </div>
                  </div>

                  <div class="flex-grow p-8 overflow-auto">
                    <div class="mx-auto max-w-3xl bg-white">
                      <div class="text-center mb-6">
                        <h2 class="text-xl font-bold">交通事故伤残鉴定报告</h2>
                        <p class="text-gray-500 text-sm mt-1">
                          报告编号: JD20250301
                        </p>
                      </div>

                      <div class="space-y-4">
                        <!-- Basic Info Section -->
                        <div class="border-b pb-2">
                          <h3 class="font-medium mb-2">基本信息</h3>
                          <div class="grid grid-cols-2 gap-2">
                            <div class="flex">
                              <span class="font-medium w-20">姓名:</span>
                              <span class="field-placeholder" data-field="name"
                                >张三</span
                              >
                            </div>
                            <div class="flex">
                              <span class="font-medium w-20">性别:</span>
                              <span
                                class="field-placeholder"
                                data-field="gender"
                                >男</span
                              >
                            </div>
                            <div class="flex">
                              <span class="font-medium w-20">年龄:</span>
                              <span class="field-placeholder" data-field="age"
                                >42岁</span
                              >
                            </div>
                            <div class="flex">
                              <span class="font-medium w-20">工作单位:</span>
                              <span
                                class="field-placeholder"
                                data-field="workUnit"
                                >北京科技有限公司</span
                              >
                            </div>
                          </div>
                        </div>

                        <!-- Incident Info Section -->
                        <div class="border-b pb-2">
                          <h3 class="font-medium mb-2">事故信息</h3>
                          <div class="space-y-2">
                            <div class="flex">
                              <span class="font-medium w-24">事故日期:</span>
                              <span
                                class="field-placeholder"
                                data-field="accidentDate"
                                >2024年3月10日</span
                              >
                            </div>
                            <div class="flex">
                              <span class="font-medium w-24">事故地点:</span>
                              <span
                                class="field-placeholder"
                                data-field="accidentLocation"
                                >北京市海淀区中关村大街</span
                              >
                            </div>
                            <div class="flex align-top">
                              <span class="font-medium w-24">事故经过:</span>
                              <span
                                class="field-placeholder flex-1"
                                data-field="accidentDetails"
                                >被鉴定人于2024年3月10日驾驶机动车行驶至北京市海淀区中关村大街时，与一辆小型客车相撞，造成左腿骨折。</span
                              >
                            </div>
                          </div>
                        </div>

                        <!-- Medical Info Section -->
                        <div class="border-b pb-2">
                          <h3 class="font-medium mb-2">医疗信息</h3>
                          <div class="space-y-2">
                            <div class="flex">
                              <span class="font-medium w-24">就诊医院:</span>
                              <span
                                class="field-placeholder"
                                data-field="hospital"
                                >北京市第三医院</span
                              >
                            </div>
                            <div class="flex">
                              <span class="font-medium w-24">诊断结果:</span>
                              <span
                                class="field-placeholder"
                                data-field="diagnosis"
                                >左腿胫骨骨折</span
                              >
                            </div>
                            <div class="flex">
                              <span class="font-medium w-24">住院天数:</span>
                              <span
                                class="field-placeholder"
                                data-field="hospitalDays"
                                >15天</span
                              >
                            </div>
                          </div>
                        </div>

                        <!-- Assessment Conclusion Section -->
                        <div>
                          <h3 class="font-medium mb-2">鉴定结论</h3>
                          <div class="p-2 border rounded bg-gray-50">
                            <p
                              class="field-placeholder"
                              data-field="conclusion"
                            >
                              根据《道路交通事故受伤人员伤残评定标准》，被鉴定人张三的伤情为九级伤残。
                            </p>
                          </div>
                        </div>
                      </div>

                      <div class="mt-6 flex justify-between">
                        <div>
                          <p class="font-medium">
                            鉴定机构:
                            <span
                              class="field-placeholder"
                              data-field="assessmentOrg"
                              >北京司法鉴定中心</span
                            >
                          </p>
                          <p class="text-sm text-gray-500">
                            鉴定日期:
                            <span
                              class="field-placeholder"
                              data-field="assessmentDate"
                              >2025年3月16日</span
                            >
                          </p>
                        </div>
                        <div class="text-right">
                          <p class="font-medium">
                            鉴定人:
                            <span
                              class="field-placeholder"
                              data-field="assessor"
                              >李医师</span
                            >
                          </p>
                          <p class="text-sm text-gray-500">
                            证书编号:
                            <span
                              class="field-placeholder"
                              data-field="certNumber"
                              >110108198505</span
                            >
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="mt-4 flex justify-end space-x-3">
                  <button
                    id="preview-report"
                    class="px-4 py-2 border rounded hover:bg-gray-50"
                  >
                    预览
                  </button>
                  <button
                    id="save-report"
                    class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                  >
                    保存报告
                  </button>
                  <button
                    id="export-pdf"
                    class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
                  >
                    导出PDF
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- AI Analysis Tab Content -->
          <div id="analysis-tab" class="document-tab-content h-full p-4">
            <div class="h-full grid grid-cols-3 gap-4">
              <!-- AI Analysis Settings -->
              <div class="bg-white rounded-lg shadow p-4">
                <h3 class="text-lg font-semibold mb-4">AI分析设置</h3>

                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >分析范围</label
                    >
                    <select
                      id="analysis-scope"
                      class="w-full p-2 border rounded"
                    >
                      <option value="all">完整案件分析</option>
                      <option value="medical">医疗记录分析</option>
                      <option value="consistency">一致性检查</option>
                      <option value="standards">标准符合性检查</option>
                      <option value="custom">自定义分析</option>
                    </select>
                  </div>

                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >分析提示</label
                    >
                    <textarea
                      id="analysis-prompt"
                      class="w-full p-2 border rounded"
                      rows="6"
                      placeholder="在此输入分析提示，例如：检查所有文档中的医学信息是否一致，是否存在矛盾的地方..."
                    >
基于报告扫描的内容，请仔细检查确认报告是正确的，没有错误用语，错别字，特别是医学用语和药品名称。报告首先给个整体的结果，是否有错误。</textarea
                    >
                  </div>

                  <div class="flex justify-between items-center">
                    <button
                      id="reset-prompt-btn"
                      class="px-3 py-1 border border-gray-300 text-gray-600 rounded hover:bg-gray-50 text-sm"
                    >
                      重置提示
                    </button>
                    <div class="space-x-2">
                      <button
                        id="cancel-analyze-btn"
                        class="hidden px-3 py-1 border border-red-300 text-red-600 rounded hover:bg-red-50 text-sm"
                      >
                        取消
                      </button>
                      <button
                        id="analyze-btn"
                        class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed"
                      >
                        开始分析
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- AI Analysis Results -->
              <div class="bg-white rounded-lg shadow p-4 col-span-2">
                <h3 class="text-lg font-semibold mb-4">分析结果</h3>

                <div
                  id="analysis-results"
                  class="border rounded p-4 h-full overflow-auto prose prose-sm max-w-none custom-scrollbar"
                ></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- 字段编辑模态框 -->
    <div
      id="key-input-modal"
      class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex items-center justify-center z-50"
    >
      <div class="bg-white p-6 rounded-lg shadow-lg max-w-md w-full">
        <h3 class="text-lg font-semibold mb-4">编辑信息</h3>

        <div class="mb-4">
          <p class="mb-2">
            已选择文本:
            <span id="modal-selected-text" class="font-mono text-sm"></span>
          </p>

          <div class="mb-3">
            <label
              for="key-input"
              class="block text-sm font-medium text-gray-700 mb-1"
              >字段名称</label
            >
            <input
              type="text"
              id="key-input"
              class="w-full p-2 border border-gray-300 rounded mb-1"
              placeholder="字段名称"
            />
          </div>

          <div class="mb-3">
            <label
              for="value-input"
              class="block text-sm font-medium text-gray-700 mb-1"
              >字段内容</label
            >
            <textarea
              id="value-input"
              class="w-full p-2 border border-gray-300 rounded resize-y"
              rows="4"
              placeholder="字段内容"
            ></textarea>
          </div>

          <div>
            <label
              for="category-select"
              class="block text-sm font-medium text-gray-700 mb-1"
              >字段分类</label
            >
            <select
              id="category-select"
              class="w-full p-2 border border-gray-300 rounded"
            >
              <option value="personal">个人信息</option>
              <option value="medical">医疗信息</option>
              <option value="incident">事故信息</option>
              <option value="legal">法律信息</option>
            </select>
          </div>
        </div>

        <div class="flex justify-end gap-2">
          <button
            id="modal-cancel"
            class="px-4 py-2 border border-gray-300 rounded hover:bg-gray-100"
          >
            取消
          </button>
          <button
            id="modal-save"
            class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
          >
            保存
          </button>
        </div>
      </div>
    </div>

    <!-- 新建/编辑案件模态框 -->
    <div
      id="case-form-modal"
      class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex items-center justify-center z-40"
    >
      <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md">
        <h2 id="form-title" class="text-xl font-bold mb-4">新建案件</h2>

        <form id="case-form">
          <div class="space-y-4">
            <div>
              <label
                for="case-name-input"
                class="block text-sm font-medium text-gray-700 mb-1"
                >姓名</label
              >
              <input
                type="text"
                id="case-name-input"
                class="w-full p-2 border rounded"
                required
              />
            </div>

            <div>
              <label
                for="case-phone-input"
                class="block text-sm font-medium text-gray-700 mb-1"
                >联系电话</label
              >
              <input
                type="text"
                id="case-phone-input"
                class="w-full p-2 border rounded"
                required
              />
            </div>

            <div>
              <label
                for="case-type-select"
                class="block text-sm font-medium text-gray-700 mb-1"
                >案件类型</label
              >
              <select id="case-type-select" class="w-full p-2 border rounded">
                <option value="交通事故">交通事故</option>
                <option value="工伤认定">工伤认定</option>
                <option value="医疗事故">医疗事故</option>
                <option value="其他伤害">其他伤害</option>
              </select>
            </div>

            <div>
              <label
                for="case-status-select"
                class="block text-sm font-medium text-gray-700 mb-1"
                >案件状态</label
              >
              <select id="case-status-select" class="w-full p-2 border rounded">
                <option value="待处理">待处理</option>
                <option value="进行中">进行中</option>
                <option value="待审核">待审核</option>
                <option value="已完成">已完成</option>
              </select>
            </div>
          </div>

          <div class="mt-6 flex justify-end gap-2">
            <button
              type="button"
              id="cancel-case-btn"
              class="px-4 py-2 border border-gray-300 rounded hover:bg-gray-100"
            >
              取消
            </button>
            <button
              type="submit"
              id="save-case-btn"
              class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
            >
              保存
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- 脚本引用 -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Base dependencies -->
    <script src="/js/config.js"></script>

    <!-- Core functionality -->
    <script src="/js/case_management/main.js"></script>
    <script src="/js/case_api.js"></script>
    <script src="/js/case_form.js"></script>

    <!-- Component modules -->
    <script src="/js/case_management/ui.js"></script>
    <script src="/js/case_management/documents.js"></script>
    <script src="/js/case_management/operations.js"></script>
    <script src="/js/case_management/init.js"></script>

    <!-- Document viewer -->
    <script src="/js/document_viewer/main.js"></script>
    <script src="/js/document_viewer/preview.js"></script>
    <script src="/js/document_viewer/ocr.js"></script>
    <script src="/js/document_viewer/organize.js"></script>
    <script src="/js/document_viewer/report.js"></script>
    <script src="/js/document_viewer/analysis.js"></script>
    <script src="/js/document_viewer/utils.js"></script>

    <!-- Initialize application -->
    <script src="/js/index.js"></script>
  </body>
</html>
